<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base de datos</title>
</head>
<body>
  <h1>Listado de Casting Calls</h1>
  <table id="tablaCastingCalls">
    <thead>
      <tr>
        <th>Foto</th>
        <th>Nombre</th>
        <th>Sexo</th>
        <th>Fecha de nacimiento</th>
        <th>Teléfono</th>
        <th>Etnia</th>
      </tr>
    </thead>
    <tbody>
      <!-- Se insertan dinámicamente -->
    </tbody>
  </table>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  // URL de tu proyecto Supabase
  const supabaseUrl = 'https://xgoebqksbwzwznqtkizq.supabase.co'; 
  // API Key pública con rol anon
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhnb2VicWtzYnd6d3pucXRraXpxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1Mzk2MDQsImV4cCI6MjA2NDExNTYwNH0.mvOWtLgH5Y05IRzcEPN6W9c9zfyc1PIcTo5HLLF89Uo';  
  // Crea cliente Supabase
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Función para cargar los datos desde la tabla 'Casting Calls'
  async function cargarCastingCalls() {
    // Consulta todos los datos de la tabla
    const { data, error } = await supabase.from('Casting Calls').select('*')

    // Si hay error, mostrar en consola y salir
    if (error) {
      console.error('Error al traer los datos:', error)
      return
    }

    // Mostrar claves del objeto para debugging
    data.forEach(row => console.log(Object.keys(row)))

    // Selecciona el tbody para insertar las filas
    const tabla = document.querySelector('#tablaCastingCalls tbody')
    // Limpia contenido previo
    tabla.innerHTML = ''
    
    // Mostrar data para debugging
    console.log(data)

    // Por cada registro, crear una fila con sus datos
    data.forEach(row => {
      console.log(row)  
      const tr = document.createElement('tr')

      tr.innerHTML = `
        <td><img src="${row.foto1}" alt="Foto de ${row.nombre}" width="100" style="object-fit: cover; height: 100px;" /></td>
        <td>${row.nombre || '-'}</td>
        <td>${row.sexo || '-'}</td>
        <td>${row.FechaDeNac || '-'}</td>
        <td>${row.tel || '-'}</td>
        <td>${row.etnia || '-'}</td>
        <td>
          <button onclick="editarCastingCall(${row.id})">Editar</button>
          <button onclick="eliminarCastingCall(${row.id})">Borrar</button>
        </td>
      `
      tabla.appendChild(tr)
    })
  }

  // Función global para redirigir a editar
  window.editarCastingCall = function(id) {
    window.location.href = `editarCastingCall.html?id=${id}`
  }

  // Función global para eliminar registro
  window.eliminarCastingCall = async function(id) {
    const confirmar = confirm('¿Estás seguro de que querés eliminar este casting call?')
    if (!confirmar) return

    const { error } = await supabase.from('Casting Calls').delete().eq('id', id)

    if (error) {
      alert('Error al borrar: ' + error.message)
      return
    }

    alert('Eliminado correctamente')
    cargarCastingCalls()
  }

  // Llama a la función al cargar la página
  cargarCastingCalls()
</script>
</body>
</html>
